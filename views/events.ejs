<%- include('partials/header') %>
    <%- include('partials/nav') %>

        <div class="container section" style="margin-top: 4rem;">
            <h1>Available Events</h1>
            <p style="margin-bottom: 2rem;">Browse and register for upcoming events.</p>

            <% if (events.length===0) { %>
                <p>No upcoming events found.</p>
                <% } else { %>
                    <div class="card-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem;">
                        <% events.forEach(event=> { %>
                            <div class="card" style="display: flex; flex-direction: column; height: 100%;">
                                <div class="card-body" style="flex: 1;">
                                    <h3 style="margin-top: 0;">
                                        <%= event.eventname %>
                                    </h3>
                                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
                                        <strong>Date:</strong>
                                        <%= new Date(event.eventdatetimestart).toLocaleString() %><br>
                                            <strong>Location:</strong>
                                            <%= event.eventlocation %>
                                    </p>
                                    <p>
                                        <%= event.eventdescription %>
                                    </p>
                                </div>
                                <div class="card-footer"
                                    style="margin-top: auto; padding-top: 1rem; border-top: 1px solid #eee;">
                                    <% if (registeredEventIds.includes(event.eventoccurrenceid)) { %>
                                        <button class="btn btn-outline" disabled
                                            style="width: 100%; cursor: default; opacity: 0.7;">Registered</button>
                                        <% } else if (participant) { %>
                                            <form action="/events/register/<%= event.eventoccurrenceid %>"
                                                method="POST">
                                                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                                <button type="submit" class="btn btn-primary"
                                                    style="width: 100%;">Register</button>
                                            </form>
                                            <% } else { %>
                                                <a href="/register" class="btn btn-primary"
                                                    style="width: 100%; text-align: center;">Register (Requires
                                                    Participant Account)</a>
                                                <% } %>
                                </div>
                            </div>
                            <% }) %>
                    </div>
                    <% } %>
        </div>

        <%- include('partials/footer') %>